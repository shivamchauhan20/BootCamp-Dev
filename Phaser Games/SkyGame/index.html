<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.24.1/phaser.js" crossorigin="true"></script>
    <title>Document</title>
</head>
<body>
    <script type="text/javascript">
        let config = {
            type : Phaser.AUTO,
            width : 800,
            height : 600,
            physics : {
                default : "arcade",
                arcade : {
                    gravity : {y : 300}
                }
            },
            scene : {
                preload : preload,
                create : setup,
                update : update
            }
        }
        let platform,player,cursor;
        function preload(){
            this.load.image("sky","assets/sky.png");
            this.load.image("platform","assets/platform.png");
            this.load.image("star","assets/star.png");
            this.load.spritesheet("player","assets/player.png",{
                frameWidth : 32,
                frameHeight : 48
            });
            this.load.image("star","assets/star.png");
        }
        function setup(){
            this.add.image(400,300,"sky");
            platform = this.physics.add.staticGroup();
            platform.create(400,580,"platform").setScale(2).refreshBody();
            platform.create(600,400,"platform");
            platform.create(70,250,"platform");
            platform.create(700,150,"platform");
            player = this.physics.add.sprite(400,100,"player");
            cursor = this.input.keyboard.createCursorKeys();
            let stars = this.physics.add.group({
                key : "star",
                repeat : 10,
                setXY : {x : 50 , y : 0 , stepX : 70}              
            })
            this.physics.add.collider(player,platform);
            this.physics.add.collider(player,stars,collectStar);
            this.physics.add.collider(platform,stars);
            stars.children.iterate(function (star){
                star.setBounceY(Phaser.Math.FloatBetween(0.4, 0.8));
            })

            this.anims.create({
                key: "left",
                frames: this.anims.generateFrameNumbers("player", { start: 0, end: 3 }),
                frameRate: 10,
                repeat: +1
            })
            this.anims.create({
                key: "right",
                frames: this.anims.generateFrameNumbers("player", { start: 5, end: 9 }),
                frameRate: 10,
                repeat: +1
            })
            this.anims.create({
                key: "normal",
                frames: this.anims.generateFrameNumbers("player", { start: 4, end: 4 }),
                frameRate: 10
            })
        }

        function collectStar(player,star) {
            star.disableBody(true, true);
        }

        function update(){
            if(cursor.left.isDown){
                player.setVelocityX(-160);
                player.anims.play("left", true);
            }
            else if(cursor.right.isDown){
                player.setVelocityX(160);
                player.anims.play("right", true);
            }
            else if(cursor.up.isDown && player.body.touching.down){
                player.setVelocityY(-360);
            }
            else{
                player.setVelocityX(0);
                player.anims.play("normal", true);
            }
        }
        new Phaser.Game(config);
    </script>
</body>
</html>